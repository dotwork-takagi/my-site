<html>

</html>

<head>
    <title>キャッチ</title>
    <link rel="stylesheet" href="css/main.css">
    <script src='js/Dollar.js'></script>
    <script src='js/main.js'></script>
    <style>
        body {
            /* background-image: url('img/bg/sougen.jpg'); */
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }

        img {
            position: absolute;
            display: none;
        }

        #apple {
            height: 3em;
            width: 3em;
        }
    </style>
</head>

<body>
    <h1>キャッチ</h1>
    <span id="gamepoint">
        <span id="count"></span>
    </span>
    <div id='gamebody'>
        <img id='dotty' src='img/dotty/default.svg'>
        <img id='apple' src='img/ringo.png'>
    </div>
</body>

<script>

    window.onload = function () {

        let isPlaying = null
        let isMousePress = false

        let count = 0
        let speed = 4

        const dotty = $('#dotty')
        const apple = $('#apple')

        let maxX = gamebody.clientWidth - apple.clientWidth
        let maxY = gamebody.clientHeight - apple.clientHeight

        let dottyX = 0
        let dottyY = 0

        let appleX = maxX / 2
        let appleY = -200

        document.body.onmousedown = () => { // ゲームを開始する
            isPlaying = true
        }

        document.body.onmousemove = (e) => { // ドッティーを描画する
            dottyX = e.clientX - dotty.width / 2
            dottyY = 480
            dotty.style.transform = `translate(${dottyX}px, ${dottyY}px)`
            dotty.style.display = 'block'
        }

        setInterval(() => { // リンゴを描画する
            if (isPlaying) {
                appleY += speed
                apple.style.transform = `translate(${appleX}px, ${appleY}px)`
                apple.style.display = 'block'
                checkHit() // 当たり判定を行う
            }
        }, 10)

        drawGamepoint() // gamepointを描画する

        function drawGamepoint() {
            document.querySelector('#count').innerHTML = `スコア: ${count}回`
        }

        function checkHit() {
            if (
                appleX > dottyX && appleX < dottyX + dotty.width &&
                appleY > dottyY && appleY < dottyY + dotty.height
            ) {
                count++
                speed += 0.25
                appleY = -200
                appleX = getRandomInt(0, maxX)
                drawGamepoint()
            }
        }
    }
</script>

</html>